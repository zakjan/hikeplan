//MQKEY=Key='[YOUR_KEY_HERE]';
MQCONFIGNUMBER=4;
if(window.MQPROTOCOL===undefined){ MQPROTOCOL=window.location.protocol==='https:'?'https://':'http://'; }
MQPLATFORMSERVER=MQPROTOCOL+"open.mapquestapi.com";
MQSTATICSERVER="http://open.mapquestapi.com/staticmap/";
MQTRAFFSERVER=TRAFFSERVER="";
MQROUTEURL="http://open.mapquestapi.com/directions/";
MQGEOCODEURL="http://open.mapquestapi.com/geocoding/";
MQNOMINATIMURL=MQPROTOCOL+"open.mapquestapi.com/";
MQSEARCHURL="";
MQLONGURL=MQPLATFORMSERVER;
MQSMSURL=MQPLATFORMSERVER;
MQTOOLKIT_VERSION="v1.0".replace(/^v/, '');
MQCDN=MQIMAGEPATH="http://api.mqcdn.com/"+"open-sdk/leaflet/v1.0/";
MQCDNCOMMON="http://api.mqcdn.com/";
MQICONSERVER=ICONSERVER=MQPROTOCOL+'icons.mqcdn.com';
LOGSERVER=MQTILELOGGER="http://coverage.osm.mapquest.com";
MQLOGURL="http://coverage.osm.mapquest.com/logger/v1";
COVSERVER=MQCOPYRIGHT="http://coverage.osm.mapquest.com";
MAPSERVER="otile1.mqcdn.com,otile2.mqcdn.com,otile3.mqcdn.com,otile4.mqcdn.com".split(",");
MAPSERVER_TILEPATH="/tiles/1.0.0/map";
MQTILEMAP="http://otile{$hostrange}.mqcdn.com/tiles/1.0.0/map/{$z}/{$x}/{$y}.{$ext}";
MQTILEMAPEXT="jpg";
MQTILEMAPHI=4;
MQTILEMAPLO=1;
SATSERVER="otile1.mqcdn.com,otile2.mqcdn.com,otile3.mqcdn.com,otile4.mqcdn.com".split(",");
SATSERVER_TILEPATH="/tiles/1.0.0/sat";
MQTILESAT="http://otile{$hostrange}.mqcdn.com/tiles/1.0.0/sat/{$z}/{$x}/{$y}.{$ext}";
MQTILESATEXT="jpg";
MQTILESATHI=4;
MQTILESATLO=1;
HYBSERVER="otile1.mqcdn.com,otile2.mqcdn.com,otile3.mqcdn.com,otile4.mqcdn.com".split(",");
HYBSERVER_TILEPATH="/tiles/1.0.0/hyb";
MQTILEHYB="http://otile{$hostrange}.mqcdn.com/tiles/1.0.0/hyb/{$z}/{$x}/{$y}.{$ext}";
MQTILEHYBEXT="png";
MQTILEHYBHI=4;
MQTILEHYBLO=1;
function $pv() {};  function $a() {};

/**
 * MapQuest tiled map toolkit.
 * Copyright 2014, MapQuest Inc.  All Rights Reserved.
 * Copying, reverse engineering, or modification is strictly prohibited.
 */
MQ.Routing={};MQ.Routing.Directions=L.Class.extend({includes:L.Mixin.Events,options:{key:null,layer:null},initialize:function(B){MQ.mapConfig.setAPIKey(this.options);L.setOptions(this,B)},route:function(H){if(H.locations.length>50){this.fire("error",{info:{statusCode:-999,description:"Too many locations, MAX=50"}})}else{H=this._checkShapeFormat(H);if(!this.noTrim){H.locations=this._trimLocations(H.locations)}var G=H.maxRoutes||1;var J="route?key="+this.options.key;if(H.options.ambiguities){var F="ignore";delete H.options.ambiguities;J+="&ambiguities="+F}J+="&json="+MQ.util.stringifyJSON(H);var I=this;MQ.mapConfig.ready(function(){MQ.util.doJSONP(MQ.mapConfig.getConfig("directionsAPI")+J,{},L.Util.bind(I._onResult,I))})}},optimizedRoute:function(E){E=this._checkShapeFormat(E);if(!this.noTrim){E.locations=this._trimLocations(E.locations)}var D="optimizedroute?key="+this.options.key;D+="&json="+MQ.util.stringifyJSON(E);var F=this;MQ.mapConfig.ready(function(){MQ.util.doJSONP(MQ.mapConfig.getConfig("directionsAPI")+D,{},L.Util.bind(F._onResult,F))})},routeShape:function(F){F=this._checkShapeFormat(F);url="routeshape?key="+this.options.key;url+="&json="+MQ.util.stringifyJSON(F);var D=this,E=this.routeShapeRequestTime=new Date().getTime();MQ.mapConfig.ready(function(){MQ.util.doJSONP(MQ.mapConfig.getConfig("directionsAPI")+url,{},function(A){if(E==D.routeShapeRequestTime){D._onResult(A)}})})},dragRoute:function(E){E=this._checkShapeFormat(E);if(!this.noTrim){E.locations=this._trimLocations(E.locations)}var D="dragroute?key="+this.options.key;D+="&json="+MQ.util.stringifyJSON(E);var F=this;MQ.mapConfig.ready(function(){MQ.util.doJSONP(MQ.mapConfig.getConfig("directionsAPI")+D,{},L.Util.bind(F._onResult,F))})},routeMatrix:function(E){var D="routematrix?key="+this.options.key;D+="&json="+MQ.util.stringifyJSON(E);var F=this;MQ.mapConfig.ready(function(){MQ.util.doJSONP(MQ.mapConfig.getConfig("directionsAPI")+D,{},L.Util.bind(F._onResult,F))})},_checkShapeFormat:function(B){if(B.options&&B.options.shapeFormat&&B.options.shapeFormat!=""){this.shapeFormat=B.options.shapeFormat;return B}if(!B.options){B.options={}}if(!B.options.shapeFormat){B.options.shapeFormat="cmp6"}return B},_onResult:function(C){if(!C||!C.route||(C.info&&C.info.messages&&C.info.messages.length>0)){var D=null;if(C&&C.info){D={code:C.info.statuscode,response:C};if(C.info.messages&&C.info.messages.length>0){D.message=C.info.messages[0]}}this.fire("error",D)}else{this.fire("success",this.decompress(C))}},_trimLocations:function(F){if(!F||F.length<1){return }var G,I=0,H=[];for(;I<F.length;I++){G=F[I];if(G&&G.linkId){var J={linkId:G.linkId,latLng:{lat:G.latLng.lat,lng:G.latLng.lng},type:G.type};H.push(J)}else{H.push(G)}}return H},decompress:function(R){if(R&&R.route&&R.route.shape&&R.route.shape.shapePoints&&R.route.options&&(R.route.options.shapeFormat=="cmp"||R.route.options.shapeFormat=="cmp6")){var S=R.route.shape.shapePoints,Q,e=R.route.alternateRoutes;var c=S.length,d=0,X=0,V=0,a=[];try{while(d<c){var W,T=0,U=0;do{W=S.charCodeAt(d++)-63;U|=(W&31)<<T;T+=5}while(W>=32);var b=((U&1)?~(U>>1):(U>>1));X+=b;T=0;U=0;do{W=S.charCodeAt(d++)-63;U|=(W&31)<<T;T+=5}while(W>=32);var Y=((U&1)?~(U>>1):(U>>1));V+=Y;if(R.route.options.shapeFormat=="cmp"){a.push(new L.LatLng(X*0.00001,V*0.00001))}else{a.push(new L.LatLng(X*0.000001,V*0.000001))}}}catch(Z){}R.route.shape.shapePoints=a}if(e){for(Q=0;Q<e.length;Q++){this.decompress(e[Q])}}return R}});MQ.routing={};MQ.routing.directions=function(B){if(B==null){B={}}if(!B.key&&MQKEY){B.key=MQKEY}return new MQ.Routing.Directions(B)};MQ.util.loadCSS(".mq-ribbon-popup .leaflet-popup-tip-container{display: none;} .mq-ribbon-popup .leaflet-popup-content-wrapper{border-radius:6px;} .mq-ribbon-popup .leaflet-popup-content-wrapper .leaflet-popup-content{margin:3px 6px;font-size:11px;}");MQ.Routing.Ribbon=L.LayerGroup.extend({includes:L.Mixin.Events,_state:"none",options:{draggable:true,dragMarker:{weight:1,color:"#000000",fill:true,fillColor:"#ffffff",opacity:0.9,fillOpacity:0.9}},initialize:function(C){L.setOptions(this,C);L.LayerGroup.prototype.initialize.call(this,C);this._polyline=new L.Polyline([],{smoothFactor:0,noClip:true,clickable:C.draggable});this.addLayer(this._polyline);var D={closeButton:false,zoomAnimation:false,autoPan:false,className:"mq-ribbon-popup",offset:new L.Point(0,-20)};this._dragPopup=L.popup(D);this._dragMarker=new L.CircleMarker(new L.LatLng(0,0),this.options.dragMarker);this._dragMarker.bindPopup(this._dragPopup)},onAdd:function(B){L.LayerGroup.prototype.onAdd.call(this,B);if(this.options.draggable){this._polyline.on("mouseover",this._onPathMouseOver,this);this._polyline.on("mousemove",this._onPathMouseMove,this);this._polyline.on("mouseout",this._onPathMouseOut,this);if(L.Browser.touch){L.DomEvent.on(this._polyline._container,"touchstart",this._onDragStart,this);L.DomEvent.on(this._polyline._container,"touchmove",this._onTouchMove,this);L.DomEvent.on(this._polyline._container,"touchend",this._onDragEnd,this);L.DomEvent.on(this._polyline._container,"touchcancel",this._onDragEnd,this)}this._dragMarker.on("mouseover",this._onMarkerMouseOver,this);this._dragMarker.on("mouseout",this._onMarkerMouseOut,this);this._dragMarker.on("mousedown",this._onDragStart,this)}},onRemove:function(B){L.LayerGroup.prototype.onRemove.call(this,B);if(this.options.draggable){this._polyline.off("mouseover",this._onPathMouseOver,this);this._polyline.off("mousemove",this._onPathMouseMove,this);this._polyline.off("mouseout",this._onPathMouseOut,this)}},setLatLngs:function(B){this._polyline.setLatLngs(B)},setPathStyle:function(B){this._polyline.setStyle(B);this._dragMarker.setRadius(B.weight/2)},_clearCancelInterval:function(){if(this._cancelInterval){window.clearInterval(this._cancelInterval);this._cancelInterval=null}},hideDragMarker:function(){this._clearCancelInterval();if(this.state=="drag"){if(this._map){this._map.off("mousemove",this._onDrag,this);this._map.off("mouseup",this._onDragEnd,this)}}this._state="none";if(this._map&&this.hasLayer(this._dragMarker)){this.removeLayer(this._dragMarker)}},closestLayerPoint:function(Q){var U=Infinity,P=this._polyline._parts,S,T,W=null;for(var O=0,R=P.length;O<R;O++){var V=P[O];for(var N=1,X=V.length;N<X;N++){S=V[N-1];T=V[N];var Y=L.LineUtil._sqClosestPointOnSegment(Q,S,T,true);if(Y<U){U=Y;W=L.LineUtil._sqClosestPointOnSegment(Q,S,T);W.partIndex=N-1}}}if(W){W.distance=Math.sqrt(U)}return W},setHoverMessage:function(B){this._dragPopup.setContent(B)},getBounds:function(){if(this._polyline){return this._polyline.getBounds()}return null},_onPathMouseOver:function(B){this._clearCancelInterval();if(this._state=="none"){this._state="hover";this.addLayer(this._dragMarker);this._dragMarker.openPopup();this._onPathMouseMove(B)}},_onPathMouseOut:function(B){if(this._state=="hover"){this._clearCancelInterval();this._cancelInterval=window.setInterval(L.Util.bind(this.hideDragMarker,this),333)}},_onPathMouseMove:function(D){if(this._state=="hover"){var F=this.closestLayerPoint(D.layerPoint);var E=this._map.layerPointToLatLng(F);this._dragShapePointIndex=F.partIndex;this._dragMarker.setLatLng(E);this._dragPopup.setLatLng(E)}},_onMarkerMouseOver:function(B){this._clearCancelInterval()},_onMarkerMouseOut:function(B){if(this._state=="hover"){this._cancelInterval=window.setInterval(L.Util.bind(this.hideDragMarker,this),333)}},_onDragStart:function(C){if(this._state!="drag"){this._state="drag";L.DomEvent.stop(C);if(L.Browser.touch){var D=this.closestLayerPoint(this._map.mouseEventToLayerPoint(C));C.dragShapePointIndex=D.partIndex}else{C.dragShapePointIndex=this._dragShapePointIndex;this._map.on("mousemove",this._onDrag,this);this._map.on("mouseup",this._onDragEnd,this)}this.fire("dragstart",C)}},_onTouchMove:function(H){if(H.touches&&H.touches.length>1){return }var G=(H.touches&&H.touches.length===1?H.touches[0]:H);var E=new L.Point(G.clientX,G.clientY);L.DomEvent.preventDefault(H);var F=this._map.mouseEventToLatLng(H);H.latlng=F;this._onDrag(H)},_onDrag:function(B){if(this._state=="drag"){this._dragMarker.setLatLng(B.latlng);this._dragPopup.setLatLng(B.latlng);this.fire("drag",B)}},_onDragEnd:function(B){if(this._state=="drag"){this.hideDragMarker();this.fire("dragend",B)}}});MQ.Routing.RouteLayer=L.LayerGroup.extend({ribbonOverscanFactor:5,dragIntervalMs:333,customizeRibbon:function(D){var C={color:"#0000ee",opacity:0.6,weight:5};if(this.options.ribbonOptions&&this.options.ribbonOptions.ribbonDisplay){C=L.Util.extend(C,this.options.ribbonOptions.ribbonDisplay)}D.setPathStyle(C)},customizeRibbonAtZoom:function(E,F){var D=this.options.ribbonOptions.widths[F-2];if(D&&D!=E._polyline.options.weight){E.setPathStyle({weight:D})}},createStopMarker:function(D,E){var F=L.icon({iconUrl:MQ.mapConfig.getConfig("iconPath")+"/icons/stop.png?text="+String.fromCharCode(E-1+65),iconSize:[22,28],iconAnchor:[11,28],popupAnchor:[0,-28]});return L.marker(D.latLng,{icon:F,draggable:this.options.draggable}).addTo(this._map)},createViaMarker:function(C){var D=L.icon({iconUrl:MQ.mapConfig.getConfig("iconPath")+"/icons/via.png",iconSize:[11,11],iconAnchor:[5,5],popupAnchor:[0,-5]});return L.marker(C.latLng,{icon:D,draggable:this.options.draggable}).addTo(this._map)},customizeMarker:function(B){},virtualMapState:function(B){return{center:B.getCenter(),width:Math.round(this.ribbonOverscanFactor*B.getSize().x),height:Math.round(this.ribbonOverscanFactor*B.getSize().y),scale:MQ.mapConfig.getScale(B.getZoom())}},recomputeChangedRoute:function(E){var D={};if(this.routeData){D=this.routeData.options;this.routeData=null}var F={mapState:this.virtualMapState(this._map),locations:E,options:D};this.directions.route(F)},options:{key:null,draggable:true,fitBounds:false,routeOptions:{},ribbonOptions:{draggable:true,widths:[10,10,10,10,9,8,7,7,7,6,6,6,6,7,8,9,10]}},initialize:function(B){MQ.mapConfig.setAPIKey(this.options);if(B&&B.ribbonOptions){B.ribbonOptions=L.extend({},this.options.ribbonOptions,B.ribbonOptions)}L.setOptions(this,B);L.LayerGroup.prototype.initialize.call(this,B);if(this.options.directions){this.directions=this.options.directions}else{this.directions=new L.Routing.Directions()}this.directions.on("success",this._onDirectionsSuccess,this);this.directions.on("error",this._onDirectionsError,this)},onAdd:function(B){L.LayerGroup.prototype.onAdd.call(this,B);B.on("move",this._validateMap,this);B.on("moveend",this._validateMap,this);B.on("zoomend",this._validateMap,this);this.state="none"},onRemove:function(B){this._stopDragTimer();B.off("move",this._validateMap,this);B.off("moveend",this._validateMap,this);B.off("zoomend",this._validateMap,this);L.LayerGroup.prototype.onRemove.call(this,B)},_onDirectionsSuccess:function(D){if(!this.routeData){this.setRouteData(D.route);if(this.options.fitBounds&&!this._fitBoundsFirstTime){this._fitBoundsFirstTime=false;this.fitBounds()}}else{if(D&&D.route&&D.route.shape){this._routeShapeCallback(D)}}if(this._lastDragRequest){this._lastDragRequest=null;if(D&&D.route&&D.route.shape&&D.route.shape.shapePoints){this._lastDragLocations=D.route.locations;for(var E=0;E<D.route.locations.length;E++){var F=D.route.locations[E];if(F.dragPoint){this._setHoverMessage(D.route,F)}}}}if(this._nextDragRequest){this._dispatchDragRequest()}},_onDirectionsError:function(B){},_setHoverMessage:function(Q,P){var K=Q.time;var M="";var N=Q.distance.toFixed(2);var S=(Q.options.unit.toUpperCase()=="M")?"mi":"km";var O=Math.floor(K/86400).toFixed();var R=Math.floor((K/3600)%24).toFixed();var J=Math.floor((K/60)%60).toFixed();if(O!=0){M+=O+"d "}if(R!=0){M+=R+"h "}if(J!=0){M+=J+"m "}this.ribbon.setHoverMessage(P.street+" ("+N+S+", "+M+")")},setRouteData:function(C){this._clear();this.routeData=C;try{if(C){this._construct(C,C.mapState,C.shape)}}catch(D){this._clear();throw D}},getBounds:function(){if(this.routeData&&this.routeData.boundingBox&&this.routeData.boundingBox.ul){return new L.LatLngBounds(new L.LatLng(this.routeData.boundingBox.lr.lat,this.routeData.boundingBox.ul.lng),new L.LatLng(this.routeData.boundingBox.ul.lat,this.routeData.boundingBox.lr.lng))}return null},fitBounds:function(){if(this._map&&this.routeData){var B=this.getBounds();if(B){this._map.fitBounds(B)}}},_validateMap:function(){if(this._ribbonInfo){var B=this._map.getPixelBounds();if(this._map.getZoom()!=this._ribbonInfo.zoom||!this._ribbonInfo.bounds.contains(B)){if(this.ribbon&&this.ribbon.dragPoi){this.ribbon.hideDragPoi()}this._schedRibbonUpdate()}}this._validateRibbonAttrs(this.ribbon)},_validateRibbonAttrs:function(D){if(!D){return }var C=this._map.getZoom();if(D._attrZoom!=C){this.customizeRibbonAtZoom(D,C);D._attrZoom=C}},_clear:function(){this.state="none";this.clearLayers();if(this._ribbonInfo&&this._ribbonInfo.completion){ribbonInfo.completion()}this.ribbon=null},_construct:function(F,E,D){this.routeData=F;this.ribbon=new MQ.Routing.Ribbon(this.options.ribbonOptions);if(this.ribbon.options.draggable){this.ribbon.setHoverMessage("Click To Drag");this.ribbon.on("dragstart",this._onRibbonDragStart,this);this.ribbon.on("drag",this._onRibbonDrag,this);this.ribbon.on("dragend",this._onRibbonDragEnd,this)}this.addLayer(this.ribbon);this.customizeRibbon(this.ribbon);this._validateRibbonAttrs(this.ribbon);this.state="show";if(E&&D&&E.zoom==this._map.getZoom()){this._ribbonInfo={loaded:true,shapeResponse:D};this._updateRibbonInfo();this.ribbon.setLatLngs(D.shapePoints);this.ribbon.shapeResponse=D;this._validateMap()}else{this._schedRibbonUpdate()}if(F.locations){this._constructLocations(F.locations)}},_constructLocations:function(G){var J,K=0,H,I,M;for(J=0;J<G.length;J++){H=G[J];switch((H.type||"").toUpperCase()){case"S":I=this.createStopMarker(H,++K);I.stopNumber=K;break;case"V":I=this.createViaMarker(H);break;default:}if(!I){continue}if(H.address&&H.address.latLng){H.latLng=H.address.latLng}I.location=H;I.locationIndex=J;if(this.options.draggable){I.on("drag",this._onMarkerDrag,this);I.on("dragend",this._onMarkerDragEnd,this)}this.customizeMarker(I);this.addLayer(I)}},_routeShapeCallback:function(E){if(!E||!E.route||!E.route.shape){this._ribbonInfo=null;return }var D=E.route.shape,F=this._ribbonInfo;F.loaded=true;F.completion=null;F.shapeResponse=D;if(L.Util.isArray(D.shapePoints)){this.ribbon.setLatLngs(D.shapePoints)}this.ribbon.shapeResponse=D},_schedRibbonUpdate:function(){if(this.state!="show"){return }var B=this.virtualMapState(this._map);this._ribbonInfo={loaded:false};this._updateRibbonInfo();this._ribbonInfo.completion=this.directions.routeShape({sessionId:this.routeData.sessionId,mapState:B});return this._ribbonInfo},_updateRibbonInfo:function(){var J=this._map.getPixelBounds();var I=J.getSize().x/2;var M=J.getSize().y/2;var G=J.min;G.x+=I;G.y+=M;var K=I*this.ribbonOverscanFactor;var H=M*this.ribbonOverscanFactor;this._ribbonInfo.bounds=new L.Bounds(new L.Point(G.x-K,G.y-H),new L.Point(G.x+K,G.y+H));this._ribbonInfo.zoom=this._map.getZoom()},_onRibbonDragStart:function(D){for(var C=0;C<this.ribbon.shapeResponse.legIndexes.length;C++){if(D.dragShapePointIndex<=this.ribbon.shapeResponse.legIndexes[C]){break}}this._dragLocationIndex=C},_onRibbonDrag:function(E){if(this.state!="show"){return }var D=this.routeData.locations.slice();for(var F=0;F<D.length;F++){D[F].dragPoint=false}D.splice(this._dragLocationIndex,0,{latLng:E.latlng,gefId:0,dragPoint:true,type:"v"});dragRouteRequest={options:this.routeData.options,locations:D,mapState:{center:this._map.getCenter(),width:Math.round(this._map.getSize().x*1.25),height:Math.round(this._map.getSize().y*1.25),scale:MQ.mapConfig.getScale(this._map.getZoom())}};this._queueDragRequest(dragRouteRequest)},_onRibbonDragEnd:function(B){this.clearDragState();if(this._lastDragLocations){this.recomputeChangedRoute(this._lastDragLocations)}},_onMarkerDrag:function(E){if(this.state!="show"){return }var D=this.routeData.locations.slice();for(var F=0;F<this.routeData.locations.length;F++){D[F].dragPoint=false}D[E.target.locationIndex]={dragPoint:true,latLng:E.target.getLatLng(),gefId:0,type:D[E.target.locationIndex].type};dragRouteRequest={options:this.routeData.options,locations:D,mapState:{center:this._map.getCenter(),width:Math.round(this._map.getSize().x*1.25),height:Math.round(this._map.getSize().y*1.25),scale:MQ.mapConfig.getScale(this._map.getZoom())}};this._queueDragRequest(dragRouteRequest)},_onMarkerDragEnd:function(B){this.clearDragState();if(this._lastDragLocations){this.recomputeChangedRoute(this._lastDragLocations)}},clearDragState:function(){this._stopDragTimer();this.state="show"},_stopDragTimer:function(){this._clearDragInterval();this._lastDragRequest=null;this._nextDragRequest=null},_clearDragInterval:function(){if(this._dragIntervalId){window.clearInterval(this._dragIntervalId);this._dragIntervalId=null}},_queueDragRequest:function(B){this._clearDragInterval();this._nextDragRequest=B;this._dragIntervalId=window.setInterval(L.Util.bind(this._dispatchDragRequest,this),this.options.dragIntervalMs)},_dispatchDragRequest:function(){if(!this._lastDragRequest&&this._nextDragRequest){this._clearDragInterval();this._lastDragRequest=this._nextDragRequest;this.directions.dragRoute(this._nextDragRequest);this._nextDragRequest=null}}});MQ.routing.routeLayer=function(B){if(B==null){B={}}if(!B.key&&MQKEY){B.key=MQKEY}return new MQ.Routing.RouteLayer(B)};
