machine:
  environment:
    PATH: ${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin

dependencies:
  cache_directories:
    - node_modules
  override:
    - npm prune && npm install

test:
  override:
    - webpack -p
  post:
    - sed -i -e 's/\/dist//' .gitignore
    - git config user.name "circleci"
    - git config user.email "zj@zakjan.cz"
    - git add -A
    - git commit -m "compile"

deployment:
  master:
    branch: master
    commands:
      - git push -f git@heroku.com:${CIRCLE_PROJECT_REPONAME}.git ${CIRCLE_BRANCH}:master
